---
layout: post
title:  "zsh で predict-on を使う"
categories: zsh config
---
zsh の補完機能は非常に便利。その、さらに便利なモードが先方予測機能
ってやつ。ただ、先鋭過ぎてちょっと困っている。

* TOC
{:toc}

# 先方予測機能とは
コマンドラインの編集（ZLE）で、キー入力毎にヒストリを参照して
候補を表示してくれる機能。

有効にするには

```sh
autoload predict-on
predict-on
```
とする。


web の解説を見ていると「鍛えれば非常に便利」とある。
と言っても、自動的に鍛えられるので、やる事は単に使い続けるだけ。
その一方、「合わなければ使わない方が良い」との記述もある。
また、方々で公開されている .zshrc を見るとコメントアウト
してある事が多い。

つまり、非常にクセが強いって事なのだろう。
特にある程度使い込むまでは。


# つ、使いにくい
こなれてくるまで時間がかかる。それまではむしろ使いにくいって事は
予想していた。

でも、コマンドラインの編集モードが変わったと思える挙動が。

編集業の途中にカーソルを持って行き、2 文字程度入力すると
その位置から後ろが全部消されてしまう。

例えば、

```console
$ ls /some/path/some.file
```
として、先頭にカーソルを持っていって

```console
$ cat /some/path/some.file
```
としようとすると

```console
$ ca
```
なんて事になるって事。


# 調査
検索してみたけど、同様の現象に言及しているページが 1 件あっただけ
だった。そのページでは単に使用をやめていただけなので、
解決につながる情報は無かった。

で、いろいろ検索しつつ考えた。

これって「後半を消去している」んではなくて、
「ヒストリでマッチしたものを表示」しているんではないだろうか。

と、いう事は「補完候補を見つけたら単にインサートする」って
挙動にするオプションが有れば良いってことになるのか？


# とりあえず回避
当面、predict-on と predict-off を手動で切り替える事にした。
検索すると、トグルするコマンドを作ったページも有ったが、
そこまではせず、単純に短いエイリアスを定義した。

```sh
alias pon='predict-on'
alias poff='predict-off'
```
こんな感じ。行の途中で編集する場合は、先に poff を実行する。
その後、pon で戻すって形。

predict-on を使い続けるかどうか、まだ考え中。

